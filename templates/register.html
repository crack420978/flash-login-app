<!DOCTYPE html>
<html>
<head>
    <title>Register</title>
    <style>
        body {
              background-color: limegreen;
            font-family: Arial, sans-serif;
            margin: 50px;
        }
        input {
            padding: 10px;
            margin: 5px 0;
            width: 200px;
        }
        button {
            padding: 10px 20px;
            background-color: blue;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: darkblue;
        }
      </style>
  </head>
<body>

<h2>Register</h2>

<!-- Flash messages -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul style="color: rgb(0, 26, 128);">
      {% for message in messages %}
        <li>{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<form method="POST" action="{{ url_for('register') }}">
    <input name="username" placeholder="Username" type="text" required><br><br>

    <input name="password" placeholder="Password" type="password" required><br><br>
    
    <div style="width: 100px; background:#ddd; height: 20px; border-radius: 0px">
      <div id="strength-bar" style="width: 0%; height: 20px; background-color: red; border-radius: 10px"></div>
    </div>
    <div id="vul-result">vulnerability:0%</div>
    <div id="strength-result">strength:0%</div>

    <button type="submit">Register</button>
</form>

<a href="{{ url_for('login') }}">Already have an account?</a>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const passwordInput = document.querySelector('input[name="password"]');
    const usernameInput = document.querySelector('input[name="username"]');     
    const vulResult = document.getElementById('vul-result');
    const strengthResult = document.getElementById('strength-result');
    const vulBar = document.getElementById('vul-bar');

    passwordInput.addEventListener('input', () => {
       fetch("/check_password", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                username: usernameInput.value,
                password: passwordInput.value   
            })
        })
        .then(response => response.json())
        .then(data => {
            vulResult.textContent = `vulnerability: ${data.vulnerability}%`;
            strengthResult.textContent = `strength: ${data.strength}%`;
            strengthBar.style.width = `${data.strength}%`;

            if (data.strength >= 30) {
                strengthBar.style.backgroundColor = 'green';
            } else if (data.strength >= 70) {
                strengthBar.style.backgroundColor = 'orange';
            } else {
                strengthBar.style.backgroundColor = 'red';
            }
        })
        .catch(error => console.error('Error:', error));
    }); 
});
</script>



</body>
</html>
