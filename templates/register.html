<!DOCTYPE html>
<html>
<head>
    <title>Register</title>
    <style>
        body {
              background-color: limegreen;
            font-family: Arial, sans-serif;
            margin: 50px;
        }
        input {
            padding: 10px;
            margin: 5px 0;
            width: 200px;
        }
        .password-container {
            position: relative;
            display: inline-block;
        }
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: blue;
        }
        button {
            padding: 10px 20px;
            background-color: blue;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: darkblue;
        }
      </style>
  </head>
<body>

<h2>Register</h2>

<!-- Flash messages -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul style="color: rgb(0, 26, 128);">
      {% for message in messages %}
        <li>{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}
<p><i>THE USER MUST FOLLOW THE BELOW CRITERIA'S</i></p>
<p>1. Password must be at least 8 characters long.</p>
<p>2. Password must contain at least one uppercase letter, one lowercase letter, one digit, and one special character.</p>
<p>3. Password should not contain the username.</p>
<p>4. Password should not be a common password.</p>

<form method="POST" action="{{ url_for('register') }}">
    <input name="username" placeholder="Username" type="text" required><br><br>

    <div class="password-container">
    <input id="password-field" name="password" placeholder="Password" type="password" required><br><br>
    <span class="toggle-password" onclick="togglePasswordVisibility()">Show</span>
    <script>
      function togglePasswordVisibility() {
        const passwordField = document.getElementById('password-field');
        const toggleButton = document.querySelector('.toggle-password');
        if (passwordField.type === 'password') {
          passwordField.type = 'text';
          toggleButton.textContent = "üôà";
        } else {
          passwordField.type = 'password';
          toggleButton.textContent = "üëÅÔ∏è";
        }
      }
    </script>   
    </div>
    


    <div style="width: 100px; background:#ddd; height: 20px; border-radius: 10px">
      <div id="strength-bar" style="width: 0%; height: 20px; background-color: red; border-radius: 10px"></div>
    </div>

    <br>

    <div id="vul-result">vulnerability:0%</div>
    <br>
    <div id="strength-result">strength:0%</div>
    <br>
    <button type="submit">Register</button>
</form>

<a href="{{ url_for('login') }}">Already have an account?</a>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const passwordInput = document.querySelector('input[name="password"]');
    const usernameInput = document.querySelector('input[name="username"]');     
    const vulResult = document.getElementById('vul-result');
    const strengthResult = document.getElementById('strength-result');
    const strengthBar = document.getElementById('strength-bar');

    passwordInput.addEventListener('input', () => {
       fetch("/check_password", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                username: usernameInput.value,
                password: passwordInput.value   
            })
        })
        .then(response => response.json())
        .then(data => {
            vulResult.textContent = `vulnerability: ${data.vulnerability}%`;
            strengthResult.textContent = `strength: ${data.strength}%`;
            strengthBar.style.width = `${data.strength}%`;

            if (data.strength >=70 && data.vulnerability <= 30) { 
                strengthBar.style.backgroundColor = 'green';
            } else if (data.strength >=40) {
                strengthBar.style.backgroundColor = 'orange';
            } else {
                strengthBar.style.backgroundColor = 'red';
            }
        })
        .catch(error => console.error('Error:', error));
    }); 
});
</script>



</body>
</html>
